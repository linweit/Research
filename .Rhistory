20+20+55
95*3
1142740+285000
tobPrice=read.xlsx('data/ConstantPrices.xlsx',sheetName='tobPrice')
#+ setup, include=FALSE
library(knitr)
opts_chunk$set(warning=FALSE,message=FALSE)
#+ Options, include=FALSE
options(width=80)
options(stringsAsFactors=FALSE)
options(scipen = 6) # bias against scientific notation
options(digits = 5) # show fewer decimal places
#+ packages, include=FALSE
packages=c('dplyr','tidyr','ggplot2','knitr','lubridate','memisc')
lapply(packages, library, character.only=T)
opts_chunk$set(warning=FALSE,message=FALSE)
setwd("C:/repo/ehrg/users/linwei/amiJACC")
library(xlsx)
tobPrice=read.xlsx('data/ConstantPrices.xlsx',sheetName='tobPrice')
names(tobPrice)=c('year','Lee','Euromonitor','ApdfFile','Current','GDPdeflator','PriceIndex','Constant2013','DutyPacket')
save(tobPrice,file='data/tobPrice.rda')
load('data/tobPrice.rda')
#+ setup, include=FALSE
library(knitr)
opts_chunk$set(warning=FALSE,message=FALSE)
#+ Options, include=FALSE
options(width=80)
options(stringsAsFactors=FALSE)
options(scipen = 6) # bias against scientific notation
options(digits = 3) # show fewer decimal places
#+ packages, include=FALSE
packages=c('dplyr','tidyr','ggplot2','knitr','lubridate','memisc')
lapply(packages, library, character.only=T)
opts_chunk$set(warning=FALSE,message=FALSE)
setwd("C:/repo/ehrg/users/linwei/amiJACC")
load('data/amiMort.rda')
head(amiMort)
amiMort=mutate(amiMort,amiAdj=100*amiAdj)  # to change 1/100,000 to per 10 million
stlByGender=function(x='M'){
data=filter(amiMort,sex==x)
df1=ts(data$amiAdj,start=c(1976,1),end=c(2013,12),frequency=12)
df1=window(df1,start=c(1979,1),end=c(2013,12),frequency=12)
fit=stl(df1,s.window='periodic')
dat=fit$time.series[,2]+fit$time.series[,3]
noSeason=data.frame(ami=as.matrix(dat,12),
sex=x,
date=as.Date(seq(ISOdate(1979,1,1), by="month", length.out=420)),
id=seq(1:420))
noSeason
}
noSeason=rbind(stlByGender('F'),stlByGender('M'),stlByGender('A'))
#' tobacco control measures
# tobControl <- read.table(file = "clipboard", sep = "\t", header=TRUE)
# save(tobControl,file='data/tobControl.rda')
load('data/tobControl.rda')
tobControlA=mutate(tobControl,
date=as.Date(date,'%d/%m/%y'),
control=paste0(controlAA,'-',controlBB))
amiTob=left_join(noSeason,tobControlA,by='date')
#' piecewise linear regression
piece.formula <- function(var.name, knots) {
formula.sign <- rep(" - ", length(knots))
formula.sign[knots < 0] <- " + "
paste(var.name, "+",
paste("I(pmax(", var.name, formula.sign, abs(knots), ", 0))", "+as.numeric(", var.name, ">", knots, ")",
collapse = " + ", sep=""))
}
# View(amiTob)   ## found out 1990-07-01 is point 139
# knotsBan = c(43,164,235,337,367)
knotsBan = c(337)
knotsTax = c(51,149,363,387)
knots=sort(c(knotsBan,knotsTax))-0
pwF=function(z='F'){
dfA=amiTob %>%
dplyr::select(id, ami,sex) %>%
filter(sex==z)
x=dfA$id
y=dfA$ami
y1=tsModel::Lag(y,1)
model <- lm(formula(paste("y ~y1+", piece.formula("x", knots))))
# model <- lm(formula(paste("y ~", piece.formula("x", knots))))
model
}
modelF=pwF('F')
modelM=pwF('M')
modelA=pwF('A')
pwList=list(modelF,modelM,modelA)
summary(modelF)
summary(modelM)
summary(modelA)
options("na.action")
pwPlotF=function(z='F'){
dfA=amiTob %>%
dplyr::select(id, ami,sex) %>%
filter(sex==z)
x=dfA$id
y=dfA$ami
y1=tsModel::Lag(y,1)
model <- lm(formula(paste("y ~y1+", piece.formula("x", knots))))
# model <- lm(formula(paste("y ~", piece.formula("x", knots))))
plot(x, y)
# new.x <- seq(min(x), max(x) ,len = 10000)
new <- data.frame(x=1:420)
points(x, predict(model, new), col = "red", pch = 18)
}
pwPlotF('F')
pwPlotF('M')
pwPlotF('A')
new.x <- seq(1:420)
predF=data.frame(sex='F',id=1:420,ddatem=as.Date(seq(ISOdate(1979,1,1), by="month", length.out=420)),predAmi=predict(modelF,data.frame(x=new.x,y1=mean(amiTob[amiTob$sex=='F',]$ami))))
#   -summary(modelF)$coef[2,1]*tsModel::Lag(amiTob[amiTob$sex=='F',]$ami,1)+summary(modelF)$coef[2,1]*amiTob[amiTob$sex=='F',]$ami[2])
#
# predAmi=predict(modelF,data.frame(x=new.x,y1=0))
#
plot(modelF)
plot(predF$predAmi)
predM=data.frame(sex='M',id=1:420,ddatem=as.Date(seq(ISOdate(1979,1,1), by="month", length.out=420)),predAmi=predict(modelM,newdata=data.frame(x=new.x,y1=mean(amiTob[amiTob$sex=='M',]$ami))))
predA=data.frame(sex='A',id=1:420,ddatem=as.Date(seq(ISOdate(1979,1,1), by="month", length.out=420)),predAmi=predict(modelA,newdata=data.frame(x=new.x,y1=mean(amiTob[amiTob$sex=='A',]$ami))))
amiMort79=filter(amiMort,ddatem>=as.Date('1979-01-01'))
pred3=rbind(predF,predM,predA)
amiPred=left_join(amiMort79,pred3,by=c('sex','ddatem'))
amiPredA=amiPred %>%
mutate(    bp=ifelse(id<=51,'[0,51]',
ifelse(51<id & id<=149,'[51,149)',
ifelse(149<id & id<=337,'[149,337)',
ifelse(337<id & id<=363,'[337,363)',
ifelse(363<id & id<=387,'[363,387)',
ifelse(id>387,'(387,420]')))))),
bpdot=(id %in% knots))
fmt<-function(x){format(x,nsmall = 0,scientific = FALSE)}
library(scales)
library(grid)
unique(amiPredA$bp)
pFemale=ggplot(amiPredA[amiPredA$sex=='F',])+geom_line(aes(ddatem,predAmi,group=bp),color='red',size=1) + geom_line(aes(ddatem,predAmi,group=1),color='red',size=0.4) + geom_line(aes(ddatem,amiAdj),color='blue',alpha=1/2) + geom_point(aes(ddatem,predAmi,size=bpdot),color='red')+scale_size_manual(values=c(0,3)) +   theme(legend.position = "none") + scale_x_date(limits = c(as.Date("1979-1-1"), as.Date('2014-1-1'))) +
scale_y_continuous('AMI Mortality (1/100,000)\n Female  ',labels=fmt) +   theme(axis.ticks.x=element_blank(),axis.text.x = element_blank(),axis.title.x=element_blank()) +
theme(axis.title.y = element_text(vjust=0.7) ) +
theme(plot.margin= unit(c(0.3, 0.5, -0.5, 0.3), "lines")) + geom_text(x = as.numeric(as.Date('2014-07-01')), y = 3.25, label = 'B', angle=0, size=6, colour='black', face="bold",hjust = 0)
pFemale
pMale=ggplot(amiPredA[amiPredA$sex=='M',])+geom_line(aes(ddatem,predAmi,group=bp),color='red',size=1) + geom_line(aes(ddatem,predAmi,group=1),color='red',size=0.4) + geom_line(aes(ddatem,amiAdj),color='blue',alpha=1/2) + geom_point(aes(ddatem,predAmi,size=bpdot),color='red')+scale_size_manual(values=c(0,3)) +   theme(legend.position = "none") + scale_x_date(limits = c(as.Date("1979-1-1"), as.Date('2014-1-1'))) +
scale_y_continuous('AMI Mortality (1/100,000)\n Male  ',labels=fmt) +   theme(axis.ticks.x=element_blank(),axis.text.x = element_blank(),axis.title.x=element_blank()) +
theme(axis.title.y = element_text(vjust=0.7) ) +
theme(plot.margin= unit(c(0.3, 0.5, -0.5, 0.3), "lines")) + geom_text(x = as.numeric(as.Date('2014-07-01')), y = 5.15, label = 'C', angle=0, size=6, colour='black', face="bold",hjust = 0)
pMale
knotsDate=as.Date(c('2007-1-1','1983-03-01', '1991-05-01','2009-03-01','2011-03-01'))
pAllGreen=ggplot(amiPredA[amiPredA$sex=='A',])+geom_line(aes(ddatem,predAmi,group=bp),color='red',size=1) + geom_line(aes(ddatem,predAmi,group=1),color='red',size=0.4) + geom_line(aes(ddatem,amiAdj),color='darkgreen',alpha=1/2) + geom_point(aes(ddatem,predAmi,size=bpdot),color='red')+scale_size_manual(values=c(0,3)) +   theme(legend.position = "none") + scale_x_date(limits = c(as.Date("1979-1-1"), as.Date('2014-1-1'))) +
scale_y_continuous('AMI Deaths \n per 10 Million  ',labels=fmt) +   theme(axis.ticks.x=element_blank(),axis.text.x = element_blank(),axis.title.x=element_blank()) +
theme(axis.title.y = element_text(vjust=0.7) ) +
theme(plot.margin= unit(c(0.3, 0.5, -0.5, 0.3), "lines")) + geom_text(x = as.numeric(as.Date('2014-07-01')), y = 5.15, label = 'C', angle=0, size=6, colour='black', face="bold",hjust = 0) + geom_vline(aes(xintercept=as.numeric(knotsDate)),linetype =5,size=0.4)
pAllGreen
tobA=tobControl %>%
filter(controlAA=='tax') %>%
mutate(tax=c(300,100,50,41.5),date=as.Date(date,'%d/%m/%y'))
library(grid)
pTob=ggplot(tobA,aes(date,tax/100))+  geom_bar(width=300,stat='identity',position = 'identity',fill='darkgreen') +
geom_segment(aes(x=as.Date('2007-01-01'),xend=as.Date('2007-01-01'),y=150/100,yend=3/100),color='purple',size=1.5,arrow=arrow(length=unit(0.4,'cm'))) +
annotate("text", x = as.Date('2007-07-01'),
y = 170/100, label = 'Smoking ban', angle=0, size=4,
colour='black', face="bold") +
theme(axis.title.x=element_blank()) +  scale_y_continuous('Percent Increase of \n Tobacco Tax  ',labels=percent) + theme(axis.title.y = element_text(vjust=0.7) ) +scale_x_date(limits = c(as.Date("1979-1-1"), as.Date('2014-1-1'))) + theme(plot.margin= unit(c(0.3, 0.5, 0, 0.3), "lines"))+ geom_text(x = as.numeric(as.Date('2014-07-01')), y = 3.0, label = 'D', angle=0, size=6, colour='black', face="bold",hjust = 0)
pTob
pTob2=ggplot(tobA,aes(date,tax/100))+  geom_bar(width=300,stat='identity',position = 'identity',fill='darkgreen') +
geom_segment(aes(x=as.Date('1982-07-01'),xend=as.Date('1982-07-01'),y=80/100,yend=2/100),color='purple',size=1.0,arrow=arrow(length=unit(0.2,'cm'))) +
geom_segment(aes(x=as.Date('1992-08-01'),xend=as.Date('1992-08-01'),y=80/100,yend=2/100),color='purple',size=1.0,arrow=arrow(length=unit(0.2,'cm'))) +
geom_segment(aes(x=as.Date('1998-07-01'),xend=as.Date('1998-07-01'),y=80/100,yend=2/100),color='purple',size=1.0,arrow=arrow(length=unit(0.2,'cm'))) +
geom_segment(aes(x=as.Date('2007-01-01'),xend=as.Date('2007-01-01'),y=150/100,yend=3/100),color='purple',size=1.5,arrow=arrow(length=unit(0.4,'cm'))) +
geom_segment(aes(x=as.Date('2009-01-01'),xend=as.Date('2009-01-01'),y=80/100,yend=2/100),color='purple',size=1.0,arrow=arrow(length=unit(0.2,'cm'))) +
annotate("text", x = as.Date('2007-07-01'),
y = 170/100, label = 'Smoking bans', angle=0, size=4,
colour='black', face="bold") +
theme(axis.title.x=element_blank()) +  scale_y_continuous('Percent Increase of \n Tobacco Tax  ',labels=percent) + theme(axis.title.y = element_text(vjust=0.7) ) +scale_x_date(limits = c(as.Date("1979-1-1"), as.Date('2014-1-1'))) + theme(plot.margin= unit(c(0.3, 0.5, 0, 0.3), "lines"))+ geom_text(x = as.numeric(as.Date('2014-07-01')), y = 3.0, label = 'D', angle=0, size=6, colour='black', face="bold",hjust = 0)
pTob2
dfA=amiTob %>%
dplyr::select(id, ami,sex) %>%
filter(sex=='A')
x=dfA$id
y=dfA$ami
y1=tsModel::Lag(y,1)
model <- lm(formula(paste("y ~y1+", piece.formula("x", c(51,149)))))
# model <- lm(formula(paste("y ~", piece.formula("x", c(51,149)))))
model
summary(model)
new.x <- seq(1:420)
predAll=data.frame(sex='A',id=1:420,ddatem=as.Date(seq(ISOdate(1979,1,1), by="month", length.out=420)),predAmi=predict(model,newdata=data.frame(x=new.x,y1=mean(amiTob[amiTob$sex=='A',]$ami))))
amiPredAll=left_join(predAll,amiMort79,by=c('sex','ddatem'))
amiPredAll2=amiPredAll %>%
mutate(bp=cut(id,breaks=c(51,149)),
bp=as.character(bp),
bp=ifelse(is.na(bp) & id<=51,'[0,51]',bp),
bpdot=(id %in% c(51,149)))
pAll=ggplot(amiPredAll2)+geom_line(aes(ddatem,predAmi,group=bp),color='red',size=1) + geom_line(aes(ddatem,predAmi,group=1),color='red',size=0.4) + geom_line(aes(ddatem,amiAdj),color='blue',alpha=1/2) + geom_point(aes(ddatem,predAmi,size=bpdot),color='red')+scale_size_manual(values=c(0,3)) +   theme(legend.position = "none") +
scale_y_continuous('AMI Mortality (1/100,000)\n All Population ',labels=fmt) +   scale_x_date(limits = c(as.Date("1979-1-1"), as.Date('2014-1-1'))) + theme(axis.ticks.x=element_blank(),axis.text.x = element_blank(),axis.title.x=element_blank()) +
theme(axis.title.y = element_text(vjust=0.7) ) +
theme(plot.margin= unit(c(0.3, 0.5, -0.5, 0.3), "lines")) + geom_text(x = as.numeric(as.Date('2014-07-01')), y = 3.7, label = 'A', angle=0, size=6, colour='black', face="bold",hjust = 0)
pAll
pAll2=pAll+scale_y_continuous('AMI Mortality \n (1/100,000)  ',labels=fmt)
pAll2
ggplot(amiPredAll2)+geom_line(aes(ddatem,predAmi,group=bp),color='red',size=1) + geom_line(aes(ddatem,predAmi,group=1),color='red',size=0.4) + geom_line(aes(ddatem,amiAdj),color='darkgreen',alpha=1/2) + geom_point(aes(ddatem,predAmi,size=bpdot),color='red')+scale_size_manual(values=c(0,3)) +   theme(legend.position = "none") + scale_x_date(limits = c(as.Date("1979-1-1"), as.Date('2014-1-1'))) +
scale_y_continuous('AMI Deaths \n per 10 Million  ',labels=fmt) +   theme(axis.ticks.x=element_blank(),axis.text.x = element_blank(),axis.title.x=element_blank()) +
theme(axis.title.y = element_text(vjust=0.7) ) +
theme(plot.margin= unit(c(0.3, 0.5, -0.5, 0.3), "lines")) + geom_text(x = as.numeric(as.Date('2014-07-01')), y = 5.15, label = 'C', angle=0, size=6, colour='black', face="bold",hjust = 0) + geom_vline(aes(xintercept=as.numeric(knotsDate)),linetype =5,size=0.4)
obacco use rate
load('data/hkSmokeP.rda')
smokeA=hkSmokeP[1:15,]
tsoutliers <- function(x,plot=FALSE)
{
x <- as.ts(x)
if(frequency(x)>1)
resid <- stl(x,s.window="periodic",robust=TRUE)$time.series[,3]
else
{
tt <- 1:length(x)
resid <- residuals(loess(x ~ tt))
}
resid.q <- quantile(resid,prob=c(0.25,0.75))
iqr <- diff(resid.q)
limits <- resid.q + 1.5*iqr*c(-1,1)
score <- abs(pmin((resid-limits[1])/iqr,0) + pmax((resid - limits[2])/iqr,0))
if(plot)
{
plot(x)
x2 <- ts(rep(NA,length(x)))
x2[score>0] <- x[score>0]
tsp(x2) <- tsp(x)
points(x2,pch=19,col="red")
return(invisible(score))
}
else
return(score)
}
x=smokeA$smkPtotal
tsoutliers(x)
smokeB=mutate(smokeA,date=ISOdate(year,month,15),date=as.Date(date))
# smokeC=subset(smokeB,select=c(date,smkPfemale,smkPmale))
# smokeD=gather(smokeC,sex,rate,-date)
df_outlier=filter(smokeB,time==10)
pOutlier=ggplot(smokeB,aes(date,smkPtotal/100))+
geom_line(color='dark green') + geom_point(size=2.5,shape=25,color='dark green',fill='dark green') +
scale_y_continuous('Smoking Prevalence  ',labels=percent) + scale_x_date(limits = c(as.Date("1979-1-1"), as.Date('2014-1-1'))) + geom_point(data=df_outlier,aes(date,smkPtotal/100),size=20,shape=1,color='red') +
theme(axis.title.x=element_blank()) +
theme(axis.title.y = element_text(vjust=0.7) ) +
theme(plot.margin= unit(c(0.3, 0.5, 0, 0.3), "lines"))
pOutlier
plot(smokeA$smkPfemale/smokeA$smkPmale)
smokeZ=smokeB %>%
dplyr::select(date,time,numCig,smkFcigL, smkFcigM, smkFcigH,smkPtotal) %>%
filter(time != 10) %>%
mutate(smkOR=(smkFcigM+smkFcigH)/smkFcigL, smkMH=smkFcigM+smkFcigH,
smkPtimesMH=smkPtotal*smkMH/10000,
smkPtimesMHLag=tsModel::Lag(smkPtimesMH,1),
# apc=(smkPtimesMH-smkPtimesMHLag)/smkPtimesMHLag*100,
ac=smkPtotal-tsModel::Lag(smkPtotal,1), ac=ifelse(is.na(ac),0,ac),
acMH=smkMH-tsModel::Lag(smkMH,1), acMH=ifelse(is.na(acMH),0,acMH),
acNum=numCig-tsModel::Lag(numCig,1), acNum=ifelse(is.na(acNum),0,acNum),
ac2=(smkPtimesMH-smkPtimesMHLag)*100,
ac2=ifelse(is.na(ac2),0,ac2),
date=as.Date(date))
ggplot(smokeZ,aes(date,ac))+  geom_line()
ggplot(smokeZ,aes(date,acMH))+  geom_line()
ggplot(smokeZ,aes(date,acNum))+  geom_line()
ggplot(smokeZ,aes(date,ac2))+  geom_line()
pSmk=ggplot(smokeZ,aes(date,smkPtimesMH))+
geom_line(color='dark green') + geom_point(size=2.5,shape=25,color='dark green',fill='dark green') +
scale_y_continuous('Moderate/high-intensity \n Smoking Prevalence  ',labels=percent) + scale_x_date(limits = c(as.Date("1979-1-1"), as.Date('2014-1-1'))) +
theme(axis.ticks.x=element_blank(),axis.text.x = element_blank(),axis.title.x=element_blank()) +
theme(axis.title.y = element_text(vjust=0.7) ) +
theme(plot.margin= unit(c(0.3, 0.5, -0.5, 0.3), "lines")) + geom_text(x = as.numeric(as.Date('2014-07-01')), y = 0.170, label = 'A', angle=0, size=6, colour='black', face="bold",hjust = 0)+ geom_vline(aes(xintercept=as.numeric(knotsDate)),linetype =5,size=0.4)
pSmk
ggplot(smokeZ,aes(date,smkPtimesMH))+
geom_line(color='dark green') + geom_point(size=2.5,shape=25,color='dark green',fill='dark green')
ggplot(smokeZ,aes(date,smkPtimesMH))+
geom_line(color='dark green') + geom_point(size=2.5,shape=25,color='dark green',fill='dark green') +
scale_y_continuous('Moderate/high-intensity \n Smoking Prevalence  ',labels=percent) + scale_x_date(limits = c(as.Date("1979-1-1"), as.Date('2014-1-1'))) +
theme(axis.ticks.x=element_blank(),axis.text.x = element_blank(),axis.title.x=element_blank()) +
theme(axis.title.y = element_text(vjust=0.7) ) +
theme(plot.margin= unit(c(0.3, 0.5, -0.5, 0.3), "lines")) + geom_text(x = as.numeric(as.Date('2014-07-01')), y = 0.170, label = 'A', angle=0, size=6, colour='black', face="bold",hjust = 0)
knotsDate
ggplot(smokeZ,aes(date,smkPtimesMH))+
geom_line(color='dark green') + geom_point(size=2.5,shape=25,color='dark green',fill='dark green') +
scale_y_continuous('Moderate/high-intensity \n Smoking Prevalence  ',labels=percent) + scale_x_date(limits = c(as.Date("1979-1-1"), as.Date('2014-1-1'))) +
theme(axis.ticks.x=element_blank(),axis.text.x = element_blank(),axis.title.x=element_blank()) +
theme(axis.title.y = element_text(vjust=0.7) ) +
theme(plot.margin= unit(c(0.3, 0.5, -0.5, 0.3), "lines")) + geom_text(x = as.numeric(as.Date('2014-07-01')), y = 0.170, label = 'A', angle=0, size=6, colour='black', face="bold",hjust = 0)+ geom_vline(data=data.frame(knotsDate),aes(xintercept=as.numeric(knotsDate)),linetype =5,size=0.4)
pSmk
pSmk=ggplot(smokeZ,aes(date,smkPtimesMH))+
geom_line(color='dark green') + geom_point(size=2.5,shape=25,color='dark green',fill='dark green') +
scale_y_continuous('Moderate/high-intensity \n Smoking Prevalence  ',labels=percent) + scale_x_date(limits = c(as.Date("1979-1-1"), as.Date('2014-1-1'))) +
theme(axis.ticks.x=element_blank(),axis.text.x = element_blank(),axis.title.x=element_blank()) +
theme(axis.title.y = element_text(vjust=0.7) ) +
theme(plot.margin= unit(c(0.3, 0.5, -0.5, 0.3), "lines")) + geom_text(x = as.numeric(as.Date('2014-07-01')), y = 0.170, label = 'A', angle=0, size=6, colour='black', face="bold",hjust = 0)+ geom_vline(data=data.frame(knotsDate),aes(xintercept=as.numeric(knotsDate)),linetype =5,size=0.4)
pSmk
ggplot(smokeZ,aes(date,ac))+  geom_line()
ggplot(smokeZ,aes(date,ac2))+  geom_line()
smokeChange=smokeZ %>%
dplyr::select(date,ac,ac2) %>%
dplyr::filter(as.numeric(rownames(smokeChange)) %in% c(2,7,14,15))
smokeZ
smokeChange=smokeZ %>%
dplyr::select(date,ac,ac2) %>%
dplyr::filter(time) %in% c(2,7,14,15))
smokeChange=smokeZ %>%
dplyr::select(date,ac,ac2) %>%
dplyr::filter(time) %in% c(2,7,14,15)
smokeChange=smokeZ %>%
dplyr::select(date,ac,ac2) %>%
dplyr::filter(time %in% c(2,7,14,15)
smokeChange=smokeZ %>%
dplyr::select(date,ac,ac2) %>%
dplyr::filter(time %in% c(2,7,14,15))
smokeChange=smokeZ %>%
dplyr::select(date,time,ac,ac2) %>%
dplyr::filter(time %in% c(2,7,14,15))
setwd("/repo/Research")
system("pandoc -s --self-contained --css=stylesLinwei.css index.md -o index.html")
setwd("/repo/Research")
system("pandoc -s --self-contained --css=stylesLinwei.css index.md -o index.html")
smokeY=smokeZ %>%
dplyr::select(date,smkFcigL, smkFcigM, smkFcigH) %>%
gather(smkF,percent,-date)
# smokeY
ggplot(smokeY,aes(factor(date),percent,fill=factor(smkF)))+  geom_bar(stat='identity',position = 'fill')
# The palette with black:
cbbPalette <- c("#000000", "#E69F00", "#56B4E9", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
library(grid)
pLMH=ggplot(smokeY,aes(date,percent,fill=factor(smkF)))+  geom_bar(width=300,stat='identity',position = 'fill',alpha=0.4)+scale_fill_manual(values = c('dark green','orange','black'))+ theme(legend.position='none')+geom_text(x = as.numeric(as.Date('1978-01-01')), y = 0.1, label = 'Light smokers', angle=0, size=4, colour='black', face="bold",hjust = 0)+ geom_text(x = as.numeric(as.Date('1978-01-01')), y = 0.6, label = 'Moderate smokers', angle=0, size=4, colour='black', face="bold",hjust = 0) + geom_text(x = as.numeric(as.Date('1978-01-01')), y = 0.94, label = 'Heavy smokers', angle=0, size=4, colour='black', face="bold",hjust = 0)+
theme(axis.ticks.x=element_blank(),axis.text.x = element_blank(),axis.title.x=element_blank()) +  scale_y_continuous('Percent of Smokers \n By Intensity ',labels=percent) + theme(axis.title.y = element_text(vjust=0.7) ) +scale_x_date(limits = c(as.Date("1979-1-1"), as.Date('2014-1-1'))) + theme(plot.margin= unit(c(0.3, 0.5, 0, 0.3), "lines"))+ geom_text(x = as.numeric(as.Date('2014-07-01')), y = 0.99, label = 'B', angle=0, size=6, colour='black', face="bold",hjust = 0)+ geom_vline(aes(xintercept=as.numeric(knotsDate)),linetype =5,size=0.4)
pLMH
pLMH=ggplot(smokeY,aes(date,percent,fill=factor(smkF)))+  geom_bar(width=300,stat='identity',position = 'fill',alpha=0.4)+scale_fill_manual(values = c('dark green','orange','black'))+ theme(legend.position='none')+geom_text(x = as.numeric(as.Date('1978-01-01')), y = 0.1, label = 'Light smokers', angle=0, size=4, colour='black', face="bold",hjust = 0)+ geom_text(x = as.numeric(as.Date('1978-01-01')), y = 0.6, label = 'Moderate smokers', angle=0, size=4, colour='black', face="bold",hjust = 0) + geom_text(x = as.numeric(as.Date('1978-01-01')), y = 0.94, label = 'Heavy smokers', angle=0, size=4, colour='black', face="bold",hjust = 0)+
theme(axis.ticks.x=element_blank(),axis.text.x = element_blank(),axis.title.x=element_blank()) +  scale_y_continuous('Percent of Smokers \n By Intensity ',labels=percent) + theme(axis.title.y = element_text(vjust=0.7) ) +scale_x_date(limits = c(as.Date("1979-1-1"), as.Date('2014-1-1'))) + theme(plot.margin= unit(c(0.3, 0.5, 0, 0.3), "lines"))+ geom_text(x = as.numeric(as.Date('2014-07-01')), y = 0.99, label = 'B', angle=0, size=6, colour='black', face="bold",hjust = 0)+ geom_vline(data=data.frame(knotsDate),aes(xintercept=as.numeric(knotsDate)),linetype =5,size=0.4)
pLMH
#' tobacco price
load('data/tobPrice.rda')
price=tobPrice %>%
mutate(month=ifelse(year ==1983,3,
ifelse(year==1991,5,
ifelse(year==2009,3,
ifelse(year==2011,3,7)))))
priceA=mutate(price,Constant2013Lag=tsModel::Lag(Constant2013,1),apc=(Constant2013-Constant2013Lag)/Constant2013Lag*100, apc2=ifelse(is.na(apc),0,apc),
date=as.Date(ISOdate(year,month,1)))
priceB=mutate(priceA,apc=apc2,apc2=NULL)
priceC=dplyr::select(priceB,year, Current,GDPdeflator,PriceIndex,Constant2013,apc)
priceChange=priceB %>%
dplyr::select(date,apc) %>%
dplyr::filter(year(date) %in% c(1983,1991,2009,2011))
names(smokeChange)=c('dateSmoke','smkPmhChange','smkPchange')
changesA=cbind(priceChange,smokeChange)
changesB=changesA %>%
gather(typeChange,value,-date,-apc,-dateSmoke)
ggplot(changesB,aes(apc,value,color=typeChange))+geom_line()+geom_point()
priceChange
changesB
smokeChange
smokeChange
smokeChange=smokeZ %>%
dplyr::select(date,time,ac,ac2) %>%
dplyr::filter(time %in% c(2,7,14,15))
smokeChange
changesA=cbind(priceChange,smokeChange)
changesB=changesA %>%
gather(typeChange,value,-date,-apc,-dateSmoke)
ggplot(changesB,aes(apc,value,color=typeChange))+geom_line()+geom_point()
changesA
smokeChange
names(smokeChange)=c('dateSmoke','time','smkPchange','smkPmhChange')
changesA=cbind(priceChange,smokeChange)
changesB=changesA %>%
gather(typeChange,value,-date,-apc,-dateSmoke)
ggplot(changesB,aes(apc,value,color=typeChange))+geom_line()+geom_point()
changesB
changesB=changesA %>%
gather(typeChange,value,-date,-apc,-dateSmoke,-time)
ggplot(changesB,aes(apc,value,color=typeChange))+geom_line()+geom_point()
ggplot(changesB,aes(apc,value,color=typeChange))+geom_line()+geom_point()+scale_y_continuous(limits = c(-4.5,0))
ggplot(changesB,aes(apc,value,group=typeChange))+geom_line(linetype=typeChange)+geom_point()+scale_y_continuous(limits = c(-4.5,0))
ggplot(changesB,aes(apc,value,group=typeChange))+geom_line(aes(linetype=typeChange))+geom_point()+scale_y_continuous(limits = c(-4.5,0))
4/50
1/50
ggplot(changesA,aes(apc,ac2))+geom_line()+geom_point()+scale_y_continuous(limits = c(-4.5,0))
changesA
ggplot(changesA,aes(apc,smkPmhChange))+geom_line()+geom_point()+scale_y_continuous(limits = c(-4.5,0))
ggplot(changesB,aes(apc,value/100,group=typeChange))++geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous(limits = c(-4.5,0))+scale_x_continuous(limits = c(12,55))
ggplot(changesB,aes(apc,value/100,group=typeChange))++geom_line(aes(linetype=typeChange),color='dark green')
changesB
ggplot(changesB,aes(apc,value,group=typeChange))+geom_line(aes(linetype=typeChange),color='red')+geom_point()+scale_y_continuous(limits = c(-4.5,0))
ggplot(changesB,aes(apc,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous(limits = c(-4.5,0))+scale_x_continuous(limits = c(12,55))
ggplot(changesB,aes(apc,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous(limits = c(-4.5,0))+scale_x_continuous(limits = c(12,55))+     theme(plot.margin= unit(c(0.3, 0.5, 0, 0.3), "lines")) +
theme(axis.ticks.x=element_blank(),axis.text.x = element_blank(),axis.title.x=element_blank()) +   scale_y_continuous('Annual Percent Change in \n Cigarette Price  ',labels=percent) + theme(axis.title.y = element_text(vjust=0.7) )+ geom_text(x = as.numeric(as.Date('2014-07-01')), y = 0.52, label = 'C', angle=0, size=6, colour='black', face="bold",hjust = 0)
ggplot(changesB,aes(apc,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous(limits = c(-4.5,0))+scale_x_continuous(limits = c(12,55))+     theme(plot.margin= unit(c(0.3, 0.5, 0.3, 0.3), "lines")) +
theme(axis.ticks.x=element_blank(),axis.text.x = element_blank(),axis.title.x=element_blank()) +   scale_y_continuous('Annual Percent Change in \n Cigarette Price  ',labels=percent) + theme(axis.title.y = element_text(vjust=0.7) )+ geom_text(x = as.numeric(as.Date('2014-07-01')), y = 0.52, label = 'C', angle=0, size=6, colour='black', face="bold",hjust = 0)
ggplot(changesB,aes(apc,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous(limits = c(-4.5,0))+scale_x_continuous(limits = c(12,55))+     theme(plot.margin= unit(c(0.3, 0.5, 0, 0.3), "lines")) +theme(axis.title.x=element_blank())
ggplot(changesB,aes(apc,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous(limits = c(-4.5,0))+scale_x_continuous(limits = c(12,55))+     theme(plot.margin= unit(c(0.3, 0.5, 0, 0.3), "lines")) +   scale_x_continuous('Percent Change in Cigarette Price',labels=percent)
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous(limits = c(-4.5,0))+scale_x_continuous(limits = c(12,55))+     theme(plot.margin= unit(c(0.3, 0.5, 0, 0.3), "lines")) +   scale_x_continuous('Percent Change in Cigarette Price',labels=percent)
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(12,55))
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(12/100,55/100))
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100))
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+ guide_legend(title = waiver())
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+ guide_legend(title = waiver(ddd))
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+ guide_legend(title = waiver('d'dd))
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+ guide_legend(title = 'dd')
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+ guide_legend(title = '')
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+ guide_legend(title = NULL)
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+ guide_legend()
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent,guide=guide_legend(title=NULL))+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+guides(guide=guide_legend(title=NULL))
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+guides(fill=guide_legend(title=NULL))
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+guides(linetype=guide_legend(title=NULL))
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.25,0.3))
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.25,0.3),linetype=guide_legend(title=NULL))
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=typeChange),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.25,0.3),legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers')),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.25,0.3),legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.25,0.3),legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100,group=typeChange))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.25,0.3),legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100,group=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))))+geom_line(color='dark green')+geom_point(size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.25,0.3),legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100,group=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))))+geom_line(color='dark green')+geom_point(size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.15,-0.035),legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100,group=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))))+geom_line(color='dark green')+geom_point(size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100,group=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))))+geom_line(color='dark green')+geom_point(size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )
ggplot(changesB,aes(apc/100,value/100,group=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))))
ggplot(changesB,aes(apc/100,value/100,group=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))))+geom_line(color='dark green')
ggplot(changesB,aes(apc/100,value/100,group=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_line()+geom_point(size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100))+geom_line(color='dark green',factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers')))+geom_point(size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100))+geom_line(color='dark green',lineshape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers')))+geom_point(size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(lineshape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers')))),color='dark green')+geom_point(size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(lineshape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(lineshape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100))
ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(lineshape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position='top',legend.title=element_blank())
ggplot(changesA,aes(apc,smkPmhChange))+geom_line()+geom_point()+scale_y_continuous(limits = c(-4.5,0))
ggplot(changesB,aes(apc,value,group=typeChange))+geom_line(aes(linetype=typeChange),color='red')+geom_point()+scale_y_continuous(limits = c(-4.5,0))
ggplot(changesB,aes(apc,value))+geom_line(aes(linetype=typeChange),color='red')+geom_point()+scale_y_continuous(limits = c(-4.5,0))
ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(lineshape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')
ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position='top',legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100),group=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers')))+geom_line(color='dark green')+geom_point(size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position='top',legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100,group=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers')))+geom_line(color='dark green')+geom_point(size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position='top',legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100,group=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))))+geom_line(color='dark green')+geom_point(size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position='top',legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100)+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position='top',legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position='top',legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(aes(shape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers')),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position='top',legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(aes(shape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position='top',legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(aes(shape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = c(0.15,-0.035), legend.position='top',legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(aes(shape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.15,-0.035),legend.title=element_blank())
ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(aes(shape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'center', legend.position=c(0.15,-0.035),legend.title=element_blank())
pElast = ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(aes(shape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'center', legend.position=c(0.25,-0.045),legend.title=element_blank())
pElast
pElast = ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(aes(shape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'center', legend.position=c(0.35,-0.025),legend.title=element_blank())
pElast
pElast = ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(aes(shape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'center', legend.position=c(0.35,-0.25),legend.title=element_blank())
pElast
pElast = ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(aes(shape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'center', legend.position=c(0.35,-0.01),legend.title=element_blank())
pElast
pElast = ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(aes(shape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.35,-0.01),legend.title=element_blank())
pElast
pElast = ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(aes(shape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.35,0.4),legend.title=element_blank())
pElast
pElast = ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(aes(shape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.35,0.2),legend.title=element_blank())
pElast
pElast = ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),color='dark green')+geom_point(aes(shape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.4,0.2),legend.title=element_blank())
pElast
ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=factor(typeChange,levels=c('ac2','ac'),labels=c('Moderate/High Density Smokers','All Smokers',))),color='dark green')+geom_point(aes(shape=factor(typeChange,labels=c('All Smokers','Moderate/High Density Smokers'))),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.4,0.2),legend.title=element_blank())
changesC=mutate(changesB,typeChange=factor(typeChange,levels=c('ac2','ac'),labels=c('Moderate/High Density Smokers','All Smokers',)))
changesC=mutate(changesB,typeChange=factor(typeChange,levels=c('ac2','ac'),labels=c('Moderate/High Density Smokers','All Smokers')))
pElast = ggplot(changesC,aes(apc/100,value/100))+geom_line(aes(linetype=typeChange),size=2,color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.4,0.2),legend.title=element_blank())
pElast
ggplot(changesC,aes(apc/100,value/100))+geom_line(aes(linetype=typeChange),size=2,color='dark green')
changesC=mutate(changesA,typeChange=factor(typeChange,levels=c('ac2','ac'),labels=c('Moderate/High Density Smokers','All Smokers')))
ggplot(changesB,aes(apc,value))+geom_line(aes(linetype=typeChange),color='red')+geom_point()+scale_y_continuous(limits = c(-4.5,0))
changesC=mutate(changesB,typeChange=factor(typeChange,levels=c('ac2','ac'),labels=c('Moderate/High Density Smokers','All Smokers')))
ggplot(changesC,aes(apc,value))+geom_line(aes(linetype=typeChange),color='red')+geom_point()+scale_y_continuous(limits = c(-4.5,0))
changesC$typeChange
changesB$typeChange
changesC=mutate(changesB,typeChange=factor(typeChange,levels=c('smkPmhChange','smkPchange'),labels=c('Moderate/High Density Smokers','All Smokers')))
pElast = ggplot(changesC,aes(apc/100,value/100))+geom_line(aes(linetype=typeChange),size=2,color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.4,0.2),legend.title=element_blank())
pElast
pElast = ggplot(changesC,aes(apc/100,value/100))+geom_line(aes(linetype=typeChange),size=1,color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.4,0.2),legend.title=element_blank())
pElast
pElast = ggplot(changesC,aes(apc/100,value/100))+geom_line(aes(linetype=typeChange),size=1,color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.4,0.2),legend.title=element_blank())+scale_fill_hue(guide = guide_legend(reverse=TRUE))
pElast
pElast = ggplot(changesC,aes(apc/100,value/100))+geom_line(aes(linetype=typeChange),size=1,color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.4,0.2),legend.title=element_blank())+guides(fill = guide_legend(reverse = TRUE))
pElast
pElast = ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=typeChange),size=1,color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.4,0.2),legend.title=element_blank())+guides(fill = guide_legend(reverse = TRUE))
pElast
pElast = ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=typeChange),size=1,color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.4,0.2),legend.title=element_blank())+scale_linetype_manual(values=c("dotdash", "dotted"))
pElast
pElast = ggplot(changesB,aes(apc/100,value/100))+geom_line(aes(linetype=typeChange),size=1,color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.4,0.2),legend.title=element_blank())+scale_linetype_manual(values=c("dashed", "solid"))
pElast
changesC=mutate(changesB,typeChange=factor(typeChange,levels=c('smkPchange','smkPmhChange'),labels=c('All Smokers','Moderate/High Density Smokers')))
pElast = ggplot(changesC,aes(apc/100,value/100))+geom_line(aes(linetype=typeChange),size=1,color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.4,0.2),legend.title=element_blank())+scale_linetype_manual(values=c("dashed", "solid"))
pElast
ggsave(pElast,file='figure/pElast.png',w=6,h=5)
pElast = ggplot(changesC,aes(apc/100,value/100))+geom_line(aes(linetype=typeChange),size=1,color='dark green')+geom_point(aes(shape=typeChange),size=3,color='dark green')+scale_y_continuous('Smoking Prevalence',limits = c(-4.5/100,0),labels=percent)+scale_x_continuous('Percent Change in Cigarette Price',labels=percent,limits = c(10/100,60/100)) + theme(axis.title.y = element_text(vjust=0.7) )+theme(legend.justification = 'right', legend.position=c(0.4,0.2),legend.title=element_blank())+scale_linetype_manual(values=c("dashed", "solid"))
pElast
ggsave(pElast,file='figure/pElast.png',w=6,h=5)
ggsave(pElast,file='figure/pElast.png',w=6,h=5)
ggsave(pElast,file='figure/pElast.png',width=6,height=5,dpi=300)
dev.off()
ggsave(pElast,file='figure/pElast.png',width=6,height=5,dpi=300)
png(file='figure/pElast.png',width=6*300,height=5*300,res=300)
pElast
dev.off()
png(file='figure/pElast.png',width=6*300,height=5*300,res=300)
pElast
dev.off()
pElast
pElast
png(file='figure/pElast.png',width=6*300,height=5*300,res=300)
pElast
dev.off()
